(function(){function s(e,t){return n.hasOwnProperty.call(e,t)}function o(e){if(h(e.toString))return e.toString();return e+""}function u(e,t,n,r){return!e?r:{key:n,value:r,index:t}}function a(e,t,n){for(var r=0;r<t.length;r++){if(t[r]===e||n&&w(t[r],e))return r}return-1}function f(e,t){var n=property.indexOf(".");if(n>-1)return f(e[property.substring(0,n)],property.substring(n+1));return e[property]}function l(e){return r.call(e)==="[object Array]"}function c(e){return r.call(e)==="[object Object]"}function h(e){return r.call(e)==="[object Function]"}function p(e){return r.call(e)==="[object Number]"&&!isNaN(e)}function d(e){return r.call(e)==="[object String]"}function v(e){return e===true||e===false}function m(e){return e instanceof T}function g(e){return c(e)||l(e)||m(e)}function y(e,t,n){if(l(e)){for(var r=0;r<e.length;r++)if(r in e&&t.call(n,e[r],r,e)===false)break}else if(m(e))e.each(t,n);else{for(var r in e)if(s(e,r)&&t.call(n,e[r],r,e)===false)break}}function b(e){var t=e;if(l(e)){t=[];for(var n=0;n<e.length;n++)if(n in e)t.push(b(e[n]))}else if(c(e)){t={};for(var r in e)if(s(e,r))t[r]=b(e[r])}return t}function w(e,t){if(l(e)){if(!l(t)||e.length!==t.length)return false;for(var n=0;n<e.length;n++)if(!w(e[n],t[n]))return false;return true}else if(m(e))return e.equals(t,true);else if(c(e)){if(!c(t)||e.constructor!==t.constructor)return false;for(var n in e)if(s(e,n))if(!s(t,n)||!w(e[n],t[n]))return false;for(var n in t)if(s(t,n))if(!s(e,n)||!w(e[n],t[n]))return false;return true}else if(r.call(e)==="[object Date]"){if(r.call(t)!=="[object Date]"||+e!==+t)return false;return true}else if(r.call(e)==="[object RegExp]"){if(r.call(t)!=="[object RegExp]"||e.source!==t.source||e.global!==t.global||e.multiline!==t.multiline||e.ignoreCase!==t.ignoreCase)return false;return true}else if(e!==e)return t!==t;return e===t}function E(e,t){for(var n=0;n<t.length;n++)if(l(t[n])){for(var r=0;r<t[n].length;r++)if(r in t[n])e.push(t[n][r])}else if(m(t[n]))t[n].each(function(t,n){if(e.containsKey(n)){if(e.override)e.replace(n,t);else e.push(t)}else e.add(n,t)});else if(c(t[n])){for(var i in t[n])if(s(t[n],i))e.add(i,t[n][i])}else e.add(t[n]);return e}function S(e,t){if(t<0){t=e.count+t;if(t<0)t=0}else if(t>e.count)t=e.count;console.log("generalized index: "+t);return t}function T(e){if(arguments.length===0)e=[];else if(!g(e))throw new Error('The object "'+e+'" is not iterable.');this._values=[];this._keys=[];this.count=0;this.validator=false;this.override=false;this.listening=true;y(e,function(e,t){this._values.push(e);this._keys.push(o(t));this.count++},this);this.events={};for(var t=0;t<x.length;t++)this.events[x[t].toLowerCase()]=[]}var e=this,t=/\s+/g,n=Object.prototype,r=n.toString,i=Array.prototype.slice;var x=["Add","Sort","Move","Clear","Remove","Reverse","Replace","Invalid","BeforeAdd","BeforeSort","BeforeMove","BeforeClear","BeforeRemove","BeforeReplace","BeforeReverse"];T.VERSION="0.1.0";T.clone=b;T.isArray=l;T.isObject=c;T.isIterable=g;T.isCollection=m;var N=T.prototype;N.on=function(e,n,r){if(c(e)){for(var i in e)if(s(e,i))this.on(i.toLowerCase(),e[i].fn||e[i].callback,e[i].scope)}else{e=e.split(t);for(var o=0;o<e.length;o++){e[o]=e[o].toLowerCase();if(!this.events[e[o]])throw new Error('The event "'+e[o]+'" is not defined.');this.events[e[o]].push({fn:n,scope:r})}}return this};N.un=N.off=function(e,n,r){e=e?e.split(t):x;for(var i=0;i<e.length;i++){var s=e[i].toLowerCase();if(!this.events[s])throw new Error('The event "'+s+'" is not defined.');for(var o=0;o<this.events[s].length;o++)if((!n||n===this.events[s][o].fn)&&(!r||r===this.events[s][o].scope)){this.events[s].splice(o,1);o--}}return this};N.trigger=function(e){if(!this.listening)return true;var t=i.call(arguments,1);e=e.toLowerCase();if(!this.events[e])throw new Error('The event "'+e+'" is not defined.');for(var n=0;n<this.events[e].length;n++)if(this.events[e][n].fn.apply(this.events[e][n].scope,t)===false)return false;return true};N.stopListening=function(){this.listening=false;return this};N.startListening=function(){this.listening=true;return this};y(x,function(e){N["on"+e]=function(t,n){this.on(e,t,n)}});N.next=function(e){if(this._index===undefined)this._index=-1;else if(this._index>=this.count)return undefined;return u(e,++this._index,this._keys[this._index],this._values[this._index])};N.previous=function(e){if(this._index===undefined)this._index=this.count;else if(this._index<0)return undefined;return u(e,--this._index,this._keys[this._index],this._values[this._index])};N.hasNext=function(){return this._index>>0<this.count};N.key=function(){return this._keys[this._index]};N.value=function(){return this._values[this._index]};N.index=function(){return this._index};N.restart=function(){delete this._index};N.insert=function(e,t,n){e=S(this,e);if(arguments.length===2){n=t;t=this.findInsertionKey()}else if(a(o(t),this._keys)!==-1){if(!this.override)return this;this.replace(t,n);return this.move(n,e)}t=o(t);if(this.validator&&this.validator(n,t,e)===false){this.trigger("invalid",n,t,e);return this}if(!this.trigger("beforeadd",n,t,e))return this;this.count++;this._values.splice(e,0,n);this._keys.splice(e,0,t);this.trigger("add",n,t,e);return this};N.add=function(e,t){return this.insert.apply(this,[this.count].concat(i.call(arguments)))};N.push=function(){for(var e=0;e<arguments.length;e++)this.insert.apply(this,[this.count,this.findInsertionKey(),arguments[e]]);return this.count};N.unshift=function(){for(var e=arguments.length-1;e>=0;e--)this.insert.apply(this,[0,this.findInsertionKey(),arguments[e]]);return this.count};N.replace=function(e,t){var n,r;e=o(e);for(r=0;r<this.count;r++){if(this._keys[r]!==e)continue;n=this._values[r];if(this.validator&&this.validator(t,e,r)===false){this.trigger("invalid",t,e,r);return this}if(!this.trigger("beforereplace",e,n,t,r))break;this._values[r]=t;this.trigger("replace",e,n,t,r);break}return this};N.concat=function(){return E(this.clone(),i.call(arguments))};N.merge=function(){return E(this,i.call(arguments))};N.item=N.get=function(e,t){return p(e)?this.getAt(e,t):this.getByKey(e,t)};N.itemAt=N.getAt=function(e,t){return u(t&&e<this.count,e,this._keys[e],this._values[e])};N.itemByKey=N.getByKey=function(e,t){var n=a(o(e),this._keys);return u(t&&n>-1,n,this._keys[n],this._values[n])};N.getCount=function(){return this.count};N.find=function(e,t,n){var r,i;for(r=0;r<this.count;r++){if(e.call(t||this,this._values[r],this._keys[r],r,this)!==true)continue;i=u(n,r,this._keys[r],this._values[r]);break}return i};N.findIndex=function(e,t,n){var r=this.find(e,t,true);if(!r)return-1;return r.index};N.includes=N.contains=function(e,t){return a(e,this._values,t)!==-1};N.containsKey=function(e){return a(o(e),this._keys)!==-1};N.values=function(){return[].concat(this._values)};N.keys=function(){return[].concat(this._keys)};N.head=N.first=function(e){return u(e&&this.count,0,this._keys[0],this._values[0])};N.tail=N.last=function(e){var t=this.count-1;return u(e&&t+1,t,this._keys[t],this._values[t])};N.getRange=N.range=N.slice=function(e,t){e=S(this,e);t=S(this,t);var n=new T;for(var r=e;r<t;r++)n.add(this._keys[r],this._values[r]);return n};N.removeAll=N.clear=function(){if(!this.trigger("beforeclear",this))return false;this.count=0;this._values=[];this._keys=[];this.trigger("clear",this);return true};N.remove=function(e,t){for(var n=0;n<this.count;n++)if(e===this._values[n]||t&&w(e,this._values[n]))return this.removeAt(n);return false};N.removeAt=function(e){var t=this._keys[e],n=this._values[e];if(e<0||e>=this.count||!this.trigger("beforeremove",n,t,e)||this.count===1&&!this.trigger("beforeclear",this))return false;this.count--;this._keys.splice(e,1);this._values.splice(e,1);this.trigger("remove",n,t,e);if(!this.count)this.trigger("clear",this);return true};N.removeByKey=function(e){return this.removeAt(a(o(e),this._keys))};N.removeCount=function(e,t){var n=0;e=S(this,e);if(!p(t))t=this.count;if(e+t>this.count)t=this.count-e;while(t>0){if(!this.removeAt(e))e++;else n++;t--}return n};N.removeRange=function(e,t){return this.removeCount(e,t-e)};N.pop=function(e){var t,n=this.count-1,r=this._keys[n],i=this._values[n];if(n<0||!this.trigger("beforeremove",i,r,n)||this.count===1&&!this.trigger("beforeclear",this))return undefined;this.count--;t=u(e,n,this._keys.pop(),this._values.pop());this.trigger("remove",i,r,n);if(!this.count)this.trigger("clear",this);return t};N.shift=function(e){var t,n=0,r=this._keys[n],i=this._values[n];if(this.count===0||!this.trigger("beforeremove",i,r,n)||this.count===1&&!this.trigger("beforeclear",this))return undefined;this.count--;t=u(e,n,this._keys.shift(),this._values.shift());this.trigger("remove",i,r,n);if(!this.count)this.trigger("clear",this);return t};N.splice=function(e,t){var n,r=e,s=new T,o=i.call(arguments,2);e=S(this,e);if(!p(t))t=this.count-e;while(t>0){n=this.getAt(e,true);if(this.removeAt(e))s.add(n.key,n.value);else e++;t--}for(var u=o.length-1;u>=0;u--)this.insert(r,this.findInsertionKey(),o[u]);return s};N.forEach=N.each=function(e,t){for(var n=0;n<this.count;n++)if(e.call(t||this,this._values[n],this._keys[n],n,this)===false)break;return this};N.indexOf=function(e,t){return a(e,this._values,t)};N.lastIndexOf=function(e,t){for(var n=this.count-1;n>=0;n--)if(this._values[n]===e||t&&w(this._values[n],e))return n;return-1};N.indexOfKey=function(e){return a(o(e),this._keys)};N.lastIndexOfKey=function(e){for(var t=this.count-1;t>=0;t--)if(this._keys[t]===e)return t;return-1};N.findInsertionKey=function(){var e=-1;for(var t=0;t<this.count;t++)if(e<this._keys[t])e=this._keys[t]>>0;return o(e+1)};N.clone=function(e){var t=new T;if(e)this.each(function(e,n){t.add(n,b(e))});else{t._values=[].concat(this._values);t._keys=[].concat(this._keys);t.count=this.count}return t};N.reverse=function(){if(!this.trigger("beforereverse",this))return this;this._keys.reverse();this._values.reverse();this.trigger("reverse",this);return this};N.map=function(e,t){var n=new T;for(var r=0;r<this.count;r++)n.add(this._keys[r],e.call(t||this,this._values[r],this._keys[r],r,this));return n};N.reduce=function(e,t,n){var r,i=0;if(arguments.length===1){if(this.count===0)throw new Error("Reduce of empty Collection with no initial value.");i=1;r=this._values[0]}else r=t;for(;i<this.count;i++)r=e.call(n||this,r,this._values[i],this._keys[i],i,this);return r};N.reduceRight=function(e,t,n){var r,i=this.count-1;if(arguments.length===1){if(this.count===0)throw new Error("Reduce of empty Collection with no initial value.");i=this.count-2;r=this._values[i+1]}else r=t;for(;i>=0;i--)r=e.call(n||this,r,this._values[i],this._keys[i],i,this);return r};N.join=function(e){return this._values.join(e)};N.all=N.every=function(e,t){for(var n=0;n<this.count;n++)if(e.call(t||this,this._values[n],this._keys[n],n,this)===false)return false;return true};N.any=N.some=function(e,t){for(var n=0;n<this.count;n++)if(e.call(t||this,this._values[n],this._keys[n],n,this))return true;return false};N.filter=function(e,t){var n=new T;for(var r=0;r<this.count;r++)if(e.call(t||this,this._values[r],this._keys[r],r,this))n.add(this._keys[r],this._values[r]);return n};N.move=function(e,t,n){var r=a(e,this._values,n);return r!==-1?this.moveIndex(r,t):false};N.moveByKey=function(e,t){var n=a(e,this._keys);return n!==-1?this.moveIndex(n,t):false};N.moveIndex=function(e,t){if(this.count<=1)return false;e=S(this,e);t=S(this,t);if(e===this.count)e--;if(t===this.count)t--;var n=this.getAt(e,true);if(!this.trigger("beforemove",n.value,n.key,n.index,t))return false;this._values.splice(e,1);this._keys.splice(e,1);this._values.splice(t+1===this.count?t-1:t,0,n.value);this._keys.splice(t+1===this.count?t-1:t,0,n.key);this.trigger("move",n.value,n.key,t,n.index);return true};N.swap=function(e,t){return this.moveIndex(e,t)&&this.moveIndex(t-1,e)};N.max=function(e,t,n){var r,i;if(!this.count)return undefined;for(var s=0;s<this.count;s++){if(e)r=e.call(t||this,this._values[s],this._keys[s],s,this);else if(p(this._values[s])||d(this._values[s]))r=this._values[s];else throw new Error("You must provide a comparator.");if(!i||r>i.computed)i={computed:r,real:u(n,s,this._keys[s],this._values[s])}}return i.real};N.min=function(e,t,n){var r,i;if(!this.count)return undefined;for(var s=0;s<this.count;s++){if(e)r=e.call(t||this,this._values[s],this._keys[s],s,this);else r=this._values[s];if(!i||r<i.computed)i={computed:r,real:u(n,s,this._keys[s],this._values[s])}}return i.real};N.avg=function(e,t){var n,r=0;for(var i=0;i<this.count;i++){if(e)n=e.call(t||this,this._values[i],this._keys[i],i,this);else if(p(this._values[i]))n=this._values[i];else if(d(this._values[i])||l(this._values[i]))n=this._values[i].length;else throw new Error("You must provide a comparator.");r+=n}return r/this.count};N.sortBy=function(e,t){var n=[],r=this;if(!this.trigger("beforesort"))return this;this.stopListening();for(var i=0;i<this.count;i++)n.push({index:i,key:this._keys[i],value:this._values[i]});n.sort(function(n,i){var s=e.call(t||r,n,i);if(s===true)s=1;else if(s===false)s=-1;return s>>0});this.clear();for(var i=0;i<n.length;i++)this.add(n[i].key,n[i].value);this.startListening();this.trigger("sort",this);return this};N.sort=function(){return this.sortBy(function(e,t){if(e.value>t.value)return 1;else if(t.value>e.value)return-1;return 0})};N.sortAsync=function(e){var t=this;e||(e={});if(h(e))e={callback:e};setTimeout(function(){if(e.fn)t.sortBy(e.fn,e.scope);else t.sort();if(e.callback)e.callback.call(t,t)},10);return this};N.equals=function(e,t){if(!m(e))return false;if(this.count!==e.count)return false;for(var n=0;n<this.count;n++)if(this._keys[n]!==e._keys[n]||!(this._values[n]===e._values[n]||t&&w(this._values[n],e._values[n])))return false;return true};e.Collection=T}).call(this)